<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Browser Fingerprint Demo ‚Äî See What You Expose</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="See exactly what information your browser and device expose that can be used to track you online ‚Äî no cookies required."
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      :root {
        --bg: #fafafa;
        --surface: #ffffff;
        --surface-alt: #f6f6f8;
        --border: #e0e0e0;
        --text: #111111;
        --text-muted: #555555;
        --accent: #2563eb;
        --accent-hover: #1d4ed8;
        --danger: #dc2626;
        --warning: #f59e0b;
        --success: #16a34a;
        --radius: 8px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --bg: #0f0f0f;
          --surface: #1a1a1a;
          --surface-alt: #252525;
          --border: #333333;
          --text: #f0f0f0;
          --text-muted: #a0a0a0;
          --accent: #3b82f6;
          --accent-hover: #60a5fa;
        }
      }

      html {
        font-size: 16px;
      }

      body {
        font-family:
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          sans-serif;
        max-width: 1000px;
        margin: 0 auto;
        padding: 16px;
        line-height: 1.6;
        color: var(--text);
        background: var(--bg);
        overflow-x: hidden;
      }

      @media (min-width: 640px) {
        body {
          padding: 24px 32px;
        }
      }

      h1 {
        font-size: 1.5rem;
        margin: 0 0 8px 0;
        line-height: 1.3;
      }

      @media (min-width: 640px) {
        h1 {
          font-size: 2rem;
        }
      }

      .intro {
        color: var(--text-muted);
        font-size: 0.95rem;
        margin: 0 0 24px 0;
      }

      .warning-banner {
        background: linear-gradient(135deg, var(--danger), #991b1b);
        color: white;
        padding: 16px;
        border-radius: var(--radius);
        margin-bottom: 24px;
        font-size: 0.9rem;
      }

      .warning-banner strong {
        display: block;
        font-size: 1rem;
        margin-bottom: 4px;
      }

      fieldset {
        margin: 0 0 20px 0;
        padding: 16px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        box-shadow: var(--shadow);
        min-width: 0;
        overflow: hidden;
      }

      @media (min-width: 640px) {
        fieldset {
          padding: 20px;
        }
      }

      legend {
        padding: 0 8px;
        font-weight: 600;
        font-size: 1rem;
      }

      pre {
        background: var(--surface-alt);
        padding: 12px;
        border-radius: var(--radius);
        overflow-x: auto;
        overflow-y: auto;
        font-size: 0.7rem;
        line-height: 1.5;
        margin: 12px 0;
        max-height: 50vh;
        white-space: pre-wrap;
        word-break: break-all;
        overflow-wrap: anywhere;
        max-width: 100%;
      }

      @media (min-width: 640px) {
        pre {
          font-size: 0.8rem;
          max-height: 60vh;
          word-break: break-word;
        }
      }

      .muted {
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      button {
        padding: 10px 16px;
        font-size: 0.9rem;
        font-weight: 500;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--surface);
        color: var(--text);
        cursor: pointer;
        transition: all 0.15s ease;
        touch-action: manipulation;
      }

      button:hover {
        background: var(--surface-alt);
        border-color: var(--accent);
      }

      button:active {
        transform: scale(0.98);
      }

      button.primary {
        background: var(--accent);
        border-color: var(--accent);
        color: white;
      }

      button.primary:hover {
        background: var(--accent-hover);
        border-color: var(--accent-hover);
      }

      .row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .controls {
        display: grid;
        gap: 8px;
        margin-bottom: 12px;
      }

      @media (min-width: 480px) {
        .controls {
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }
      }

      label.switch {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        padding: 8px 12px;
        background: var(--surface-alt);
        border-radius: var(--radius);
        font-size: 0.9rem;
        user-select: none;
        transition: background 0.15s ease;
      }

      label.switch:hover {
        background: var(--border);
      }

      label.switch input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
        cursor: pointer;
        flex-shrink: 0;
      }

      .button-row {
        display: grid;
        gap: 8px;
        grid-template-columns: repeat(3, 1fr);
      }

      @media (max-width: 400px) {
        .button-row {
          grid-template-columns: 1fr;
        }
      }

      .info-section h2 {
        font-size: 1.1rem;
        margin: 0 0 12px 0;
        color: var(--text);
      }

      .info-grid {
        display: grid;
        gap: 12px;
      }

      @media (min-width: 640px) {
        .info-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 16px;
        }
      }

      .info-card {
        background: var(--surface-alt);
        padding: 12px 14px;
        border-radius: var(--radius);
        border-left: 3px solid var(--accent);
      }

      .info-card strong {
        display: block;
        font-size: 0.85rem;
        color: var(--accent);
        margin-bottom: 4px;
      }

      .info-card p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--text-muted);
        line-height: 1.5;
      }

      .ethics-note {
        background: linear-gradient(135deg, var(--success), #15803d);
        color: white;
        padding: 16px;
        border-radius: var(--radius);
        margin-top: 16px;
        font-size: 0.9rem;
      }

      .ethics-note strong {
        display: block;
        margin-bottom: 4px;
      }

      .fingerprint-display {
        background: linear-gradient(135deg, var(--accent), #1e40af);
        color: white;
        padding: 12px 16px;
        border-radius: var(--radius);
        margin: 12px 0;
        font-family: monospace;
        font-size: 0.75rem;
        word-break: break-all;
        text-align: center;
      }

      @media (min-width: 640px) {
        .fingerprint-display {
          font-size: 0.85rem;
        }
      }

      .fingerprint-display .label {
        display: block;
        font-family: system-ui, sans-serif;
        font-weight: 600;
        font-size: 0.8rem;
        margin-bottom: 6px;
        opacity: 0.9;
      }

      .stat-bar {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin: 16px 0;
        padding: 12px;
        background: var(--surface-alt);
        border-radius: var(--radius);
      }

      .stat {
        flex: 1;
        min-width: 100px;
        text-align: center;
      }

      .stat .value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent);
      }

      .stat .desc {
        font-size: 0.75rem;
        color: var(--text-muted);
      }

      footer {
        margin-top: 32px;
        padding-top: 16px;
        border-top: 1px solid var(--border);
        text-align: center;
        color: var(--text-muted);
        font-size: 0.85rem;
      }

      footer a {
        color: var(--accent);
        text-decoration: none;
      }

      footer a:hover {
        text-decoration: underline;
      }

      /* Loading state */
      .loading {
        display: inline-block;
        animation: pulse 1.5s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      /* Collapsible sections for mobile */
      details {
        margin-bottom: 20px;
      }

      details summary {
        cursor: pointer;
        padding: 16px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        font-weight: 600;
        list-style: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: var(--shadow);
      }

      details summary::-webkit-details-marker {
        display: none;
      }

      details summary::after {
        content: "‚ñ∏";
        transition: transform 0.2s ease;
      }

      details[open] summary::after {
        transform: rotate(90deg);
      }

      details[open] summary {
        border-radius: var(--radius) var(--radius) 0 0;
      }

      details .content {
        padding: 16px;
        background: var(--surface);
        border: 1px solid var(--border);
        border-top: none;
        border-radius: 0 0 var(--radius) var(--radius);
      }
    </style>
  </head>
  <body>
    <header>
      <h1>üîç Browser Fingerprint Demo</h1>
      <p class="intro">
        See exactly what information your browser and device expose that can be used to track you online ‚Äî
        <strong>no cookies or logins required</strong>.
      </p>
    </header>

    <div class="warning-banner">
      <strong>‚ö†Ô∏è You Are Being Tracked Right Now</strong>
      Every website you visit can collect this information. Even in "private browsing" mode, your browser fingerprint remains largely the
      same, making you identifiable across sites.
    </div>

    <div class="stat-bar">
      <div class="stat">
        <div class="value" id="dataPointCount">‚Äî</div>
        <div class="desc">Data Points Collected</div>
      </div>
      <div class="stat">
        <div class="value" id="uniquenessScore">‚Äî</div>
        <div class="desc">Uniqueness Estimate</div>
      </div>
      <div class="stat">
        <div class="value" id="trackability">‚Äî</div>
        <div class="desc">Trackability</div>
      </div>
    </div>

    <div class="fingerprint-display">
      <span class="label">Your Browser Fingerprint Hash</span>
      <span id="fpHash" class="loading">Calculating...</span>
    </div>

    <fieldset>
      <legend><strong>üìä Collected Data (JSON)</strong></legend>
      <div class="controls">
        <label class="switch"><input id="toggleCanvas" type="checkbox" checked /> Canvas fingerprint</label>
        <label class="switch"><input id="toggleWebGL" type="checkbox" checked /> WebGL info</label>
        <label class="switch"><input id="toggleFonts" type="checkbox" checked /> Font detection</label>
      </div>
      <pre id="out"><span class="loading">Collecting data from your browser...</span></pre>
      <div class="button-row">
        <button id="copyBtn">üìã Copy</button>
        <button id="downloadBtn">üíæ Download</button>
        <button id="refreshBtn" class="primary">üîÑ Refresh</button>
      </div>
    </fieldset>

    <fieldset>
      <legend><strong>üñ•Ô∏è Simulated Server Log</strong></legend>
      <p class="muted">
        This is what a real server would see. The IP address and TLS details are marked as placeholders since this demo runs entirely in
        your browser.
      </p>
      <pre id="serverLog"><span class="loading">Generating...</span></pre>
    </fieldset>

    <details open>
      <summary>üìã What's Being Collected</summary>
      <div class="content">
        <div class="info-grid">
          <div class="info-card">
            <strong>üåê Browser & Device</strong>
            <p>User agent, browser brands, platform, CPU architecture, device memory, and hardware specs.</p>
          </div>
          <div class="info-card">
            <strong>üì± Screen & Display</strong>
            <p>Screen resolution, viewport size, pixel ratio, color depth, and orientation.</p>
          </div>
          <div class="info-card">
            <strong>‚öôÔ∏è System Preferences</strong>
            <p>Dark mode, reduced motion, contrast settings, color gamut, HDR support, pointer type.</p>
          </div>
          <div class="info-card">
            <strong>‚è±Ô∏è Performance Data</strong>
            <p>Navigation timing, first paint times, resource loading stats, memory usage.</p>
          </div>
          <div class="info-card">
            <strong>üì° Network Info</strong>
            <p>Connection type (4G, WiFi), estimated bandwidth, round-trip time, data saver mode.</p>
          </div>
          <div class="info-card">
            <strong>üíæ Storage</strong>
            <p>Estimated quota, used storage, cookie availability, localStorage support.</p>
          </div>
          <div class="info-card">
            <strong>üé® Canvas & WebGL</strong>
            <p>Graphics card info, WebGL renderer, canvas rendering hash ‚Äî highly unique identifiers.</p>
          </div>
          <div class="info-card">
            <strong>üî§ Fonts & Audio</strong>
            <p>Installed fonts detection, audio context sample rate ‚Äî both reveal system configuration.</p>
          </div>
          <div class="info-card">
            <strong>üé§ Media Devices</strong>
            <p>Count of cameras, microphones, speakers ‚Äî without asking for permission.</p>
          </div>
          <div class="info-card">
            <strong>üåç Locale & Timezone</strong>
            <p>Language, timezone, calendar system, numbering format, UTC offset.</p>
          </div>
          <div class="info-card">
            <strong>üõ°Ô∏è Ad Blocker Detection</strong>
            <p>Whether ad-blocking is active ‚Äî tracked to fingerprint privacy-conscious users.</p>
          </div>
          <div class="info-card">
            <strong>üîë Feature Detection</strong>
            <p>Supported APIs, Do Not Track setting, service workers, clipboard, sharing capabilities.</p>
          </div>
        </div>

        <div class="ethics-note">
          <strong>‚úÖ This Demo Is Safe</strong>
          This page runs 100% in your browser. No data is sent anywhere ‚Äî there's no server, no tracking, no cookies. View the source code
          to verify. The purpose is purely educational: to show what <em>can</em> be collected, so you can better protect yourself.
        </div>
      </div>
    </details>

    <details open>
      <summary>üõ°Ô∏è How to Protect Yourself</summary>
      <div class="content">
        <div class="info-grid">
          <div class="info-card">
            <strong>ü¶ä Use Firefox with Resist Fingerprinting</strong>
            <p>Enable privacy.resistFingerprinting in about:config. This normalizes many fingerprintable values.</p>
          </div>
          <div class="info-card">
            <strong>üßÖ Use Tor Browser</strong>
            <p>Tor Browser is designed to make all users look identical, defeating fingerprinting techniques.</p>
          </div>
          <div class="info-card">
            <strong>üîå Browser Extensions</strong>
            <p>Tools like Canvas Blocker, uBlock Origin, and Privacy Badger can help reduce tracking surface.</p>
          </div>
          <div class="info-card">
            <strong>üì± Brave Browser</strong>
            <p>Brave includes built-in fingerprinting protection that randomizes or blocks many techniques.</p>
          </div>
        </div>
      </div>
    </details>

    <footer>
      <p>
        Built to educate about browser fingerprinting.
        <a href="https://github.com/marcusmichaels/fingerprintd" target="_blank" rel="noopener">View Source</a>
      </p>
      <p>No data is collected, stored, or transmitted. Everything runs locally in your browser.</p>
    </footer>

    <script>
      // ---- small utils ----------------------------------------------------------
      function safe(fn, fallback = null) {
        try {
          return fn();
        } catch (e) {
          return fallback;
        }
      }
      async function sha256Hex(str) {
        const enc = new TextEncoder().encode(str);
        const buf = await crypto.subtle.digest("SHA-256", enc);
        return Array.from(new Uint8Array(buf))
          .map((b) => b.toString(16).padStart(2, "0"))
          .join("");
      }
      function mm(q) {
        return typeof matchMedia === "function" ? matchMedia(q).matches : null;
      }

      // ---- canvas fingerprint (toggleable) --------------------------------------
      function canvasDataUrl() {
        try {
          const c = document.createElement("canvas");
          c.width = 260;
          c.height = 60;
          const x = c.getContext("2d");
          x.fillStyle = "#f0f0f0";
          x.fillRect(0, 0, c.width, c.height);
          x.fillStyle = "#111";
          x.textBaseline = "middle";
          x.font = '18px "Arial"';
          x.fillText("CanvasFingerprint ‚úì ùîóùî¢ùî∞ùî±", 10, 22);
          x.fillStyle = "rgba(255,0,0,0.6)";
          x.beginPath();
          x.arc(200, 38, 10, 0, Math.PI * 2);
          x.fill();
          return c.toDataURL();
        } catch (e) {
          return null;
        }
      }

      // ---- WebGL info (vendor/renderer if available) ----------------------------
      function webglInfo() {
        try {
          const c = document.createElement("canvas");
          const gl = c.getContext("webgl") || c.getContext("experimental-webgl");
          if (!gl) return null;
          const info = {
            antialias: gl.getContextAttributes()?.antialias ?? null,
            renderer: null,
            vendor: null,
            shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),
            version: gl.getParameter(gl.VERSION),
          };
          const dbg = gl.getExtension("WEBGL_debug_renderer_info");
          if (dbg) {
            info.vendor = gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL);
            info.renderer = gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL);
          }
          return info;
        } catch (e) {
          return null;
        }
      }

      // ---- Quick font presence check (no network) -------------------------------
      function detectFonts(
        list = [
          "Arial",
          "Times New Roman",
          "Courier New",
          "Comic Sans MS",
          "Monaco",
          "Helvetica Neue",
          "Georgia",
          "Verdana",
          "Impact",
          "Trebuchet MS",
        ],
      ) {
        try {
          const test = document.createElement("span");
          test.innerHTML = "mmmmmmmmmlllllIIIIWWWWW";
          test.style.cssText = "position:absolute;left:-9999px;top:-9999px;font-size:32px;";
          document.body.appendChild(test);
          const base = {};
          for (const baseFam of ["monospace", "serif", "sans-serif"]) {
            test.style.fontFamily = baseFam;
            base[baseFam] = { w: test.offsetWidth, h: test.offsetHeight };
          }
          const present = {};
          for (const font of list) {
            let found = false;
            for (const baseFam of ["monospace", "serif", "sans-serif"]) {
              test.style.fontFamily = `'${font}',${baseFam}`;
              if (test.offsetWidth !== base[baseFam].w || test.offsetHeight !== base[baseFam].h) {
                found = true;
                break;
              }
            }
            present[font] = found;
          }
          document.body.removeChild(test);
          return present;
        } catch (e) {
          return null;
        }
      }

      // ---- Ad-block heuristic ---------------------------------------------------
      function adblockHeuristic() {
        try {
          const bait = document.createElement("div");
          bait.className = "adsbox ad ads banner ad-placement ad-unit ad-zone";
          bait.style.cssText = "position:absolute;left:-9999px;top:-9999px;width:1px;height:1px;";
          document.body.appendChild(bait);
          const blocked = getComputedStyle(bait).display === "none" || bait.offsetParent === null || bait.clientHeight === 0;
          document.body.removeChild(bait);
          return blocked;
        } catch (e) {
          return null;
        }
      }

      // ---- Count data points recursively ----------------------------------------
      function countDataPoints(obj, depth = 0) {
        if (depth > 10) return 0;
        if (obj === null || obj === undefined) return 0;
        if (typeof obj !== "object") return 1;
        if (Array.isArray(obj)) return obj.reduce((sum, item) => sum + countDataPoints(item, depth + 1), 0);
        return Object.values(obj).reduce((sum, val) => sum + countDataPoints(val, depth + 1), 0);
      }

      // ---- Gather everything ----------------------------------------------------
      async function gather(opts) {
        const nav = navigator;

        // User-Agent Client Hints (low + some high-entropy if available)
        let uaCH = null;
        try {
          if (nav.userAgentData) {
            uaCH = {
              brands: nav.userAgentData.brands || null,
              mobile: nav.userAgentData.mobile || false,
              platform: nav.userAgentData.platform || null,
            };
            if (typeof nav.userAgentData.getHighEntropyValues === "function") {
              try {
                const high = await nav.userAgentData.getHighEntropyValues([
                  "architecture",
                  "bitness",
                  "model",
                  "platformVersion",
                  "uaFullVersion",
                ]);
                Object.assign(uaCH, high);
              } catch (e) {}
            }
          }
        } catch (e) {}

        // Performance + paints + navigation entry
        const perf = {};
        try {
          const p = performance;
          const navEntry = p.getEntriesByType?.("navigation")?.[0] || null;
          const paints = p.getEntriesByType?.("paint") || [];
          perf.now = p.now?.() ?? null;
          perf.navigation = navEntry ? { type: navEntry.type, redirectCount: navEntry.redirectCount } : null;
          perf.timing = p.timing
            ? {
                navigationStart: p.timing.navigationStart,
                domContentLoadedEventEnd: p.timing.domContentLoadedEventEnd,
                loadEventEnd: p.timing.loadEventEnd,
              }
            : null;
          perf.paints = paints.map((x) => ({ name: x.name, startTime: Math.round(x.startTime) }));
          perf.resources = (p.getEntriesByType?.("resource") || []).slice(0, 8).map((r) => ({
            name: r.name,
            initiatorType: r.initiatorType,
            duration: Math.round(r.duration),
          }));
          // Chrome-only memory stats (coarse)
          perf.memory = performance.memory
            ? {
                jsHeapSizeLimit: performance.memory.jsHeapSizeLimit,
                totalJSHeapSize: performance.memory.totalJSHeapSize,
                usedJSHeapSize: performance.memory.usedJSHeapSize,
              }
            : null;
        } catch (e) {}

        // Network information
        const conRaw = nav.connection || nav.mozConnection || nav.webkitConnection || null;
        const connection = conRaw
          ? {
              effectiveType: conRaw.effectiveType,
              downlink: conRaw.downlink,
              rtt: conRaw.rtt,
              saveData: conRaw.saveData,
            }
          : null;

        // Storage estimate
        const storage = await (nav.storage && nav.storage.estimate ? nav.storage.estimate() : Promise.resolve(null)).catch(() => null);

        // AudioContext
        const audio = safe(() => {
          const AC = window.AudioContext || window.webkitAudioContext;
          if (!AC) return null;
          const ctx = new AC();
          const info = { sampleRate: ctx.sampleRate };
          ctx.close?.();
          return info;
        });

        // Media devices (counts only; labels empty without permission)
        let mediaDevices = null;
        try {
          if (nav.mediaDevices?.enumerateDevices) {
            const list = await nav.mediaDevices.enumerateDevices();
            mediaDevices = ["audioinput", "audiooutput", "videoinput"].reduce(
              (acc, k) => ((acc[k] = list.filter((d) => d.kind === k).length), acc),
              {},
            );
          }
        } catch (e) {
          mediaDevices = null;
        }

        // Preferences via media queries
        const prefs = {
          prefersColorScheme: mm("(prefers-color-scheme: dark)") ? "dark" : mm("(prefers-color-scheme: light)") ? "light" : "no-preference",
          prefersReducedMotion: mm("(prefers-reduced-motion: reduce)"),
          prefersContrast: mm("(prefers-contrast: more)")
            ? "more"
            : mm("(prefers-contrast: less)")
              ? "less"
              : mm("(prefers-contrast: no-preference)")
                ? "no-preference"
                : null,
          forcedColors: mm("(forced-colors: active)"),
          invertedColors: mm("(inverted-colors: inverted)"),
          colorGamut: mm("(color-gamut: rec2020)") ? "rec2020" : mm("(color-gamut: p3)") ? "p3" : mm("(color-gamut: srgb)") ? "srgb" : null,
          hdr: mm("(dynamic-range: high)"),
          pointer: mm("(pointer: fine)") ? "fine" : mm("(pointer: coarse)") ? "coarse" : mm("(pointer: none)") ? "none" : null,
          hover: mm("(hover: hover)") ? "hover" : mm("(hover: none)") ? "none" : null,
        };

        // WebGL
        const webgl = opts.includeWebGL ? webglInfo() : null;

        // Canvas hash
        const canvasData = opts.includeCanvas ? canvasDataUrl() : null;
        const canvasHash = canvasData ? await sha256Hex(canvasData) : null;

        // Fonts quick check
        const fonts = opts.includeFonts ? detectFonts() : null;

        // Intl / timezone / locale
        const intl = safe(() => {
          const ro = Intl.DateTimeFormat().resolvedOptions();
          return {
            locale: ro.locale,
            timeZone: ro.timeZone,
            calendar: ro.calendar,
            numberingSystem: ro.numberingSystem,
            hourCycle: ro.hourCycle || null,
            timeZoneNameExample: new Date().toString(),
            utcOffsetMinutes: new Date().getTimezoneOffset(),
          };
        });

        // Screen & viewport
        const screenInfo = {
          width: screen.width,
          height: screen.height,
          availWidth: screen.availWidth,
          availHeight: screen.availHeight,
          colorDepth: screen.colorDepth,
          pixelDepth: screen.pixelDepth,
          devicePixelRatio: window.devicePixelRatio || 1,
          orientation: safe(() => ({ type: screen.orientation?.type || null, angle: screen.orientation?.angle || 0 })),
        };
        const viewport = {
          innerWidth: window.innerWidth,
          innerHeight: window.innerHeight,
          outerWidth: window.outerWidth,
          outerHeight: window.outerHeight,
          scrollX: window.scrollX,
          scrollY: window.scrollY,
        };

        // Document/page basics
        const page = {
          href: location.href,
          referrer: document.referrer || null,
          title: document.title || null,
          visibilityState: document.visibilityState,
          wasPrerendered: document.prerendering || false,
          historyLength: history.length,
        };

        // Features present
        const features = {
          cookiesEnabled: nav.cookieEnabled,
          documentCookie: document.cookie || null, // not HttpOnly
          localStorage: safe(() => typeof localStorage !== "undefined"),
          sessionStorage: safe(() => typeof sessionStorage !== "undefined"),
          serviceWorker: "serviceWorker" in nav,
          serviceWorkerControlled: !!nav.serviceWorker?.controller,
          webgl: !!webgl,
          webp: null,
          doNotTrack: nav.doNotTrack || null,
          onLine: nav.onLine,
          clipboard: "clipboard" in nav,
          share: "share" in nav,
          vibration: "vibrate" in nav,
        };

        // Quick WebP support check
        try {
          const img = new Image();
          features.webp = await new Promise((res) => {
            img.onload = () => res(img.width === 1 && img.height === 1);
            img.onerror = () => res(false);
            img.src = "data:image/webp;base64,UklGRiIAAABXRUJQVlA4TCEAAAAvAAAAAAfQ//73v/+BiOh/AAA=";
          });
        } catch (e) {
          features.webp = null;
        }

        // Ad-block heuristic
        const adblock = adblockHeuristic();

        // Navigator summary
        const navSummary = {
          userAgent: nav.userAgent,
          platform: nav.platform,
          languages: nav.languages || [nav.language || null],
          hardwareConcurrency: nav.hardwareConcurrency || null,
          deviceMemory: nav.deviceMemory || null,
          maxTouchPoints: nav.maxTouchPoints || 0,
          plugins: Array.from(nav.plugins || [])
            .map((p) => p.name)
            .slice(0, 12),
        };

        // Build collected object
        const collected = {
          ts: new Date().toISOString(),
          page,
          viewport,
          screen: screenInfo,
          navigator: navSummary,
          uaCH,
          prefs,
          connection,
          storage,
          audio,
          mediaDevices,
          performance: perf,
          webgl,
          canvasHash,
          fonts,
          intl,
          features,
          adblockDetected: adblock,
        };

        // Derived fingerprint (demo): hash a subset of relatively stable values
        const fpSource = JSON.stringify({
          ua: nav.userAgent,
          brands: uaCH?.brands,
          mobile: uaCH?.mobile,
          plat: uaCH?.platform,
          arch: uaCH?.architecture,
          bit: uaCH?.bitness,
          lang: nav.languages,
          tz: intl?.timeZone,
          offs: intl?.utcOffsetMinutes,
          scr: [screenInfo.width, screenInfo.height, screenInfo.colorDepth, screenInfo.pixelDepth, screenInfo.devicePixelRatio],
          pref: prefs,
          webgl: webgl ? [webgl.vendor, webgl.renderer] : null,
          fonts,
          hwc: nav.hardwareConcurrency,
          dm: nav.deviceMemory,
          touch: nav.maxTouchPoints,
          canvas: canvasHash,
        });
        collected.fingerprint = await sha256Hex(fpSource);

        return collected;
      }

      // ---- Simulated server log -------------------------------------------------
      function makeSimulatedServerLog(col) {
        const time = new Date().toLocaleString();
        const path = new URL(col.page.href).pathname + new URL(col.page.href).search;
        const requestLine = `GET ${path || "/"} HTTP/1.1`;
        const referer = col.page.referrer || "-";
        const ua = col.navigator.userAgent || "-";
        const remoteAddr = "[YOUR_IP_ADDRESS]";
        const tls = "[TLS_VERSION, CIPHER_SUITE]";
        const xff = "[PROXY_CHAIN_IPS]";
        const status = 200,
          bytes = 12345;
        const rt = Math.round(col.performance?.now || 0);
        return `${remoteAddr} - - [${time}] "${requestLine}" ${status} ${bytes} "${referer}" "${ua}" rt=${rt}ms\n\nAdditional server-side data:\n- TLS: ${tls}\n- X-Forwarded-For: ${xff}\n- Accept-Language: ${col.navigator.languages?.join(", ")}\n- Screen: ${col.screen.width}x${col.screen.height}`;
      }

      // ---- Wire up UI -----------------------------------------------------------
      (async function () {
        const out = document.getElementById("out");
        const serverEl = document.getElementById("serverLog");
        const copyBtn = document.getElementById("copyBtn");
        const dlBtn = document.getElementById("downloadBtn");
        const refreshBtn = document.getElementById("refreshBtn");
        const toggleCanvas = document.getElementById("toggleCanvas");
        const toggleWebGL = document.getElementById("toggleWebGL");
        const toggleFonts = document.getElementById("toggleFonts");
        const fpHashEl = document.getElementById("fpHash");
        const dataPointCountEl = document.getElementById("dataPointCount");
        const uniquenessEl = document.getElementById("uniquenessScore");
        const trackabilityEl = document.getElementById("trackability");

        async function update() {
          out.innerHTML = '<span class="loading">Collecting data from your browser...</span>';
          serverEl.innerHTML = '<span class="loading">Generating...</span>';
          fpHashEl.className = "loading";
          fpHashEl.textContent = "Calculating...";

          const data = await gather({
            includeCanvas: toggleCanvas.checked,
            includeWebGL: toggleWebGL.checked,
            includeFonts: toggleFonts.checked,
          });

          out.textContent = JSON.stringify(data, null, 2);
          serverEl.textContent = makeSimulatedServerLog(data);

          // Update fingerprint display
          fpHashEl.className = "";
          fpHashEl.textContent = data.fingerprint;

          // Update stats
          const pointCount = countDataPoints(data);
          dataPointCountEl.textContent = pointCount;

          // Estimate uniqueness based on key factors
          let uniqueFactors = 0;
          if (data.canvasHash) uniqueFactors += 3;
          if (data.webgl?.renderer) uniqueFactors += 2;
          if (data.fonts && Object.keys(data.fonts).length > 5) uniqueFactors += 2;
          if (data.screen.devicePixelRatio !== 1) uniqueFactors += 1;
          if (data.navigator.plugins?.length > 0) uniqueFactors += 1;
          if (data.uaCH?.architecture) uniqueFactors += 1;

          const uniqueLevel = uniqueFactors >= 7 ? "Very High" : uniqueFactors >= 4 ? "High" : uniqueFactors >= 2 ? "Medium" : "Low";
          uniquenessEl.textContent = uniqueLevel;

          trackabilityEl.textContent = uniqueFactors >= 5 ? "Easily" : uniqueFactors >= 3 ? "Likely" : "Possibly";
        }

        copyBtn.addEventListener("click", async () => {
          try {
            await navigator.clipboard.writeText(out.textContent);
            copyBtn.textContent = "‚úì Copied!";
            setTimeout(() => (copyBtn.textContent = "üìã Copy"), 1500);
          } catch (e) {
            alert("Copy failed: " + e.message);
          }
        });

        dlBtn.addEventListener("click", () => {
          const blob = new Blob([out.textContent], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = Object.assign(document.createElement("a"), { href: url, download: "browser-fingerprint.json" });
          document.body.appendChild(a);
          a.click();
          a.remove();
          URL.revokeObjectURL(url);
        });

        refreshBtn.addEventListener("click", update);
        toggleCanvas.addEventListener("change", update);
        toggleWebGL.addEventListener("change", update);
        toggleFonts.addEventListener("change", update);

        await update();
      })();
    </script>
  </body>
</html>
